jQuery(window).on('changed.am.section',function(e,section){if(jQuery.inArray(AmCharts.Editor.current.section,['publish','share'])==-1){return;}
if(AmCharts.Editor.current.section=='share'&&!jQuery(section).data('loaded')){AmCharts.Editor.log('info','load section share');jQuery(section).load(AmCharts.Editor.CONSTANT.URL_BASE+'static/tpl/section-share.tpl?'+ AmCharts.Editor.CONSTANT.RND_KEY,function(){jQuery(section).data('loaded',true);AmCharts.Editor.updateSection('share');AmCharts.Editor.getUser();});}else{AmCharts.Editor.log('info','process section share');(function(){if(!AmCharts.ValueAxis.prototype.patched){var TMP=AmCharts.ValueAxis.prototype.draw;AmCharts.ValueAxis.prototype.patched=true;AmCharts.ValueAxis.prototype.draw=function(theme){if(this.minimumDate&&typeof this.minimumDate=="string"){this.minimumDate=AmCharts.stringToDate(this.minimumDate,this.chart.dataDateFormat||"YYYY-MM-DD");}
if(this.maximumDate&&typeof this.maximumDate=="string"){this.maximumDate=AmCharts.stringToDate(this.maximumDate,this.chart.dataDateFormat||"YYYY-MM-DD");}
TMP.apply(this,arguments);}}})();var timer=0;AmCharts.Editor.drawCSS=function(trigger){var cloneCSS=jQuery.extend({},AmCharts.Editor.current.css);var rgb=cloneCSS['backgroundRGBA'];var alpha=cloneCSS['backgroundAlpha']/100;jQuery('.am-share-chart div + div').css({height:''});cloneCSS['width']+='%';cloneCSS['height']+='%';cloneCSS['backgroundColor']='rgba('+ rgb.r+','+ rgb.g+','+ rgb.b+','+ alpha+')';try{AmCharts.Editor.chart["export"].defaults.fabric.backgroundColor=cloneCSS['backgroundColor'];}catch(err){}
if(trigger=='init'||trigger=='backgroundImageShow'){jQuery('.app-section-share').css({backgroundImage:cloneCSS['backgroundImageShow']?'url('+ cloneCSS['backgroundImage']+')':''});}
jQuery('.am-share-modal .modal-content').css(cloneCSS);jQuery('.am-share-modal .modal-content')[AmCharts.Editor.current.css['boxShadow']?'removeClass':'addClass']('less-shadow');if(trigger!='spectrum'){jQuery('.app-section-share .ui-control-color input').spectrum('set',AmCharts.Editor.current.css.backgroundColor.toUpperCase());}
if(AmCharts.Editor.current.section=='share'){if(trigger=='init'){AmCharts.Editor.init(AmCharts.Editor.current.cfg);}else if(AmCharts.Editor.chart.invalidateSize){AmCharts.Editor.chart.invalidateSize();clearTimeout(timer);if(trigger!='dontsave'){timer=setTimeout(function(){AmCharts.Editor.saveCSS();},500);}}}}
if(AmCharts.Editor.current.section=='share'){jQuery('.am-editor-themes li a').off().on('click',function(e){e.preventDefault();var theme=jQuery(this).parent().data('theme');jQuery('.am-editor-themes li').each(function(){jQuery(this)[theme==jQuery(this).data('theme')?'addClass':'removeClass']('active');});AmCharts.Editor.applyTheme(theme);AmCharts.Editor.current.css.backgroundColor=AmCharts.Editor.chart.backgroundColor;AmCharts.Editor.current.css.backgroundRGBA=AmCharts.Editor.hexToRgb(AmCharts.Editor.current.css.backgroundColor);if(AmCharts.Editor.current.section=='share'){AmCharts.Editor.drawCSS();}}).tooltip({title:function(){return AmCharts.Editor.getMSG('tooltip_set_theme').replace('[[theme]]',jQuery(this).parent().data('theme'));}});jQuery('.app-section-share '+' .ui-control-slider').each(function(){var propertyName=jQuery(this).data('prop');var propertyConfig={min:0,max:100,val:AmCharts.Editor.current.css[propertyName]};if(propertyName=='width'||propertyName=='height'){propertyConfig.min=20;}
jQuery(this).find('div').slider({min:propertyConfig.min,max:propertyConfig.max,value:propertyConfig.val,step:(propertyConfig.max- propertyConfig.min)/ 100,
slide:function(event,ui){AmCharts.Editor.current.css[propertyName]=ui.value;AmCharts.Editor.drawCSS();}});});jQuery('.app-section-share .ui-control-color').each(function(){jQuery(this).find('input').val(AmCharts.Editor.current.css.backgroundColor).spectrum({allowEmpty:false,showPalette:true,showButtons:false,preferredFormat:'hex',localStorageKey:'ameditor.colors',move:function(color){this.value=color.toHexString().toUpperCase();AmCharts.Editor.current.css['backgroundColor']=this.value;AmCharts.Editor.current.css['backgroundRGBA']=color.toRgb();AmCharts.Editor.drawCSS('spectrum');}}).on('blur',function(){AmCharts.Editor.current.css['backgroundColor']=this.value.toUpperCase();AmCharts.Editor.current.css['backgroundRGBA']=AmCharts.Editor.hexToRgb(this.value);AmCharts.Editor.drawCSS();});});var offset=0;var amount=30;function getImages(o,a){jQuery.ajax({dataType:'json',url:AmCharts.Editor.CONSTANT.URL_BASE+'images/',data:{o:o,a:a,},complete:function(transport){var response=transport.responseJSON||{error:true};var bgList=jQuery('.menu-item-background ul');var path=AmCharts.Editor.CONSTANT.URL_CDN;if(!response.error){path+=response.path;jQuery(response.photos).each(function(id){var tmpItem=jQuery('<li></li>').appendTo(bgList);var tmpLink=jQuery('<a></a>').appendTo(tmpItem);var tmpThumbnail=path+'tn/'+ this;var tmpBackground=path+'bg/'+ this;tmpLink.data('src',tmpBackground).css({backgroundImage:'url('+ tmpThumbnail+')'}).on('click',function(e){var that=this;e.preventDefault();if(AmCharts.Editor.current.css.backgroundImageShow){AmCharts.Editor.current.css.backgroundImage=jQuery(this).data("src");jQuery(that).addClass('loading');jQuery('<img>').attr('src',AmCharts.Editor.current.css.backgroundImage).on('load',function(){jQuery(that).removeClass('loading');jQuery('.app-section-share').css({backgroundImage:'url('+ AmCharts.Editor.current.css.backgroundImage+')'});});AmCharts.Editor.saveCSS();}}).addClass('loading').css({backgroundColor:'#EFEFEF'});jQuery('<img>').attr('src',tmpThumbnail).on('load',function(){jQuery(tmpLink).removeClass('loading').css({backgroundColor:''});});});offset+=amount;if(!response.photos.length||response.photos.length<amount){var tmpItem=jQuery('<li>').appendTo(bgList.parents('ul.menu-group-items'));jQuery('<div>').addClass('alert alert-info').text(AmCharts.Editor.getMSG('message_share_images_limit')).appendTo(tmpItem);}else{jQuery('.menu-group-customize > div').off().on('scroll',function(){var height=jQuery('.navbar-share-customize').off().height();var scrollTop=jQuery(this).scrollTop();if(height- jQuery(window).height()<=scrollTop){jQuery('.menu-group-customize > div').off();getImages(offset,amount);}});}}
if(!AmCharts.Editor.current.css['backgroundImage']){jQuery(jQuery('.menu-item-background ul li a')[Math.floor(Math.random()*(amount- 0+ 1))]).trigger('click');}}});}
getImages(offset,amount);jQuery('.app-section-share .menu-item-boolean')[AmCharts.Editor.current.css.boxShadow?'addClass':'removeClass']('selected');jQuery('.app-section-share .menu-item-boolean .menu-item-check').on('click',function(){AmCharts.Editor.current.css['boxShadow']=jQuery('.app-section-share .menu-item-boolean .menu-item-check').parents('.menu-item').toggleClass('selected').is('.selected');AmCharts.Editor.drawCSS('boxShadow');});jQuery('.app-section-share .menu-item-background')[AmCharts.Editor.current.css.backgroundImageShow?'addClass':'removeClass']('selected');jQuery('.app-section-share .menu-item-background .menu-item-check').on('click',function(){AmCharts.Editor.current.css['backgroundImageShow']=jQuery(this).parents('.menu-item').toggleClass('selected').is('.selected');AmCharts.Editor.drawCSS('backgroundImageShow');});jQuery('.app-section-share .am-menu-new a').off().on('click',function(e){e.preventDefault();jQuery.router.go('/new/');});jQuery('.app-section-share .am-menu-edit a').off().on('click',function(e){e.preventDefault();jQuery.router.go('/'+ AmCharts.Editor.current.chart.chart_id+'/edit/');});jQuery('.app-section-share .am-menu-user, .app-section-share .am-menu-signin').off().on('show.bs.dropdown hide.bs.dropdown',function(e){if(e.type=='show'){jQuery(document.body).addClass('modal-open');jQuery('<div class="modal-backdrop modal-backdrop-login fade"></div>').appendTo(document.body).one(jQuery.support.transition.end,function(){jQuery(this).addClass('in');}).emulateTransitionEnd(0);if(!jQuery('.app-section-share .navbar-signin .dropdown-menu iframe').data('loaded')){jQuery('.app-section-share .navbar-signin .dropdown-menu iframe').attr('src',AmCharts.Editor.CONSTANT.URL_AMCHARTS+'sign-in/editor/?redirect_to='+ location.protocol+ AmCharts.Editor.CONSTANT.URL_BASE+'auth/done/?'+ AmCharts.Editor.CONSTANT.RND_KEY).data('loaded',true);}}else{jQuery(document.body).removeClass('modal-open');jQuery('.modal-backdrop-login').removeClass('in').one(jQuery.support.transition.end,function(){jQuery(this).remove();}).emulateTransitionEnd(300);}});}
jQuery('.app-section-share .copyCat').each(function(){new ZeroClipboard(this).off().on('mouseover mouseout',function(e){jQuery(e.target).attr('aria-label',AmCharts.Editor.getMSG('tooltip_clipboard_copy'))[e.type=='mouseover'?'addClass':'removeClass']('cssTooltip');}).on('copy',function(e){jQuery(e.target).attr('aria-label',AmCharts.Editor.getMSG('tooltip_clipboard_copied'));});});jQuery('.app-section-share .app-menu, .global-zeroclipboard-container').off().on('click',function(e){e.stopPropagation();});jQuery('.app-section-share .app-menu > ul > li > a').off().on('click',function(e){var that=this;e.preventDefault();e.stopPropagation();if(jQuery(this).parent().hasClass('menu-group-publish')){ga('send',{'hitType':'event','eventCategory':'Buttons','eventAction':'Click','eventLabel':'Share and Publish',});}
jQuery('.app-section-share .app-menu > ul > li > a').each(function(id,tab){if(that!=tab){jQuery(this).parent().removeClass('active');}else{jQuery(this).parent().toggleClass('active');}});jQuery('.app-section-share .app-menu')[jQuery('.app-section-share .app-menu > ul > li.active').length?'addClass':'removeClass']('active');});jQuery('.btn-send-email').off().on('click',function(e){jQuery('.app-section-share fieldset').attr('disabled',true);jQuery.ajax({url:'/view.php',data:{chart_id:AmCharts.Editor.current.chart.chart_id,email:jQuery('#am-share-email').val()},complete:function(transport){jQuery('.app-section-share fieldset').attr('disabled',false);}});});var url=(location.protocol?location.protocol:'http:')+ AmCharts.Editor.CONSTANT.URL_BASE+ AmCharts.Editor.current.chart.chart_id+'/';jQuery('.am-share-link').val(url);jQuery('.am-share-embed').val('<iframe width=\"600\" height=\"400\" src=\"'+ url+'embed/\" frameborder=\"0\"></iframe>');jQuery('.btn-share').off().on('click',function(){var btn=this;var SOCIAL_TITLE="Online Chart Maker | amCharts";var SOCIAL_SUMMARY=""
var SOCIAL_ID=AmCharts.Editor.current.chart.chart_id;var SOCIAL_URL="http://live.amcharts.com/"+ SOCIAL_ID+"/";var SOCIAL_IMAGE="http://generated.amcharts.com/"+ SOCIAL_ID.slice(0,2)+"/"+ SOCIAL_ID+"-full.png";SOCIAL_IMAGE=SOCIAL_URL+"static/share/"+ SOCIAL_ID+".png";SOCIAL_SUMMARY='I\'ve created my chart online, ensure to take a look!\n\nBuild your own free chart like this and share on [[network]] or add as interactive widget to your website.';if(jQuery(btn).hasClass("btn-facebook")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Facebook");shareURL="https://www.facebook.com/sharer/sharer.php?";sharePARAMS={s:100,p:{url:SOCIAL_URL}}}else if(jQuery(btn).hasClass("btn-twitter")){SOCIAL_SUMMARY='Build your own free chart like this and share on [[network]] or add as interactive widget to your website.';SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Twitter");shareURL="https://twitter.com/intent/tweet?";sharePARAMS={url:SOCIAL_URL,text:SOCIAL_SUMMARY}}else if(jQuery(btn).hasClass("btn-google-plus")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Google");shareURL="https://plus.google.com/share?";sharePARAMS={url:SOCIAL_URL}}else if(jQuery(btn).hasClass("btn-tumblr")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Tumblr");shareURL="https://www.tumblr.com/share/link/?";sharePARAMS={url:SOCIAL_URL,title:SOCIAL_TITLE,description:SOCIAL_SUMMARY}}else if(jQuery(btn).hasClass("btn-linkedin")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Linkedin");shareURL="https://www.linkedin.com/shareArticle?";sharePARAMS={url:SOCIAL_URL,title:SOCIAL_TITLE,summary:SOCIAL_SUMMARY,source:SOCIAL_URL,mini:true}}else if(jQuery(btn).hasClass("btn-pinterest")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Pinterest");shareURL="https://www.pinterest.com/pin/create/button/?";sharePARAMS={url:SOCIAL_URL,title:SOCIAL_TITLE,media:SOCIAL_IMAGE,description:SOCIAL_SUMMARY}}else if(jQuery(btn).hasClass("btn-reddit")){SOCIAL_SUMMARY=SOCIAL_SUMMARY.replace("[[network]]","Reddit");SOCIAL_URL=SOCIAL_URL.replace("?","")+ location.hash;shareURL="https://www.reddit.com/submit?";sharePARAMS={url:SOCIAL_URL,title:SOCIAL_TITLE,media:SOCIAL_IMAGE,text:SOCIAL_SUMMARY}}
window.open(shareURL+ jQuery.param(sharePARAMS),'','menubar=no,toolbar=no,resizable=no,scrollbars=no,height=400,width=600');});jQuery(".app-section-share .app-header .btn-flat").off().on("click",function(){jQuery(".app-section-share .app-header .navbar-nav").toggleClass("collapse");});AmCharts.Editor.drawCSS('init');}});jQuery(document).on('click',function(){jQuery('.app-section-share .app-menu, .app-section-share .menu-group').removeClass('active');});jQuery(window).on('changed.am.user.badge',function(){if(AmCharts.Editor.current.section=='share'){}});