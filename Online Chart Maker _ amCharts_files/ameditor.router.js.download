jQuery.router.add('/',function(){AmCharts.Editor.log('info','route landing');AmCharts.Editor.updateSection('landing');AmCharts.Editor.modal('hide');})
jQuery.router.add('/new/','/new/',function(data){AmCharts.Editor.log('info','route new chart');AmCharts.Editor.updateSection('editor');AmCharts.Editor.modal({remote:AmCharts.Editor.CONSTANT.URL_BASE+'static/tpl/modal-chart-new.tpl?__='+ AmCharts.Editor.CONSTANT.RND_KEY});});jQuery.router.add('/new/edit/','/new/edit/',function(data){AmCharts.Editor.log('info','route new chart edit');if(AmCharts.Editor.current.user.loading){return false;}
if(AmCharts.Editor.current.stranger){AmCharts.Editor.current.chart.chart_id='';AmCharts.Editor.current.stranger=false;AmCharts.Editor.updateUserNav();}else if(AmCharts.Editor.current.tpl.name&&!AmCharts.Editor.current.tpl.loaded){AmCharts.Editor.updateSection('editor');AmCharts.Editor.current.user.loading=true;jQuery.ajax({dataType:'json',url:AmCharts.Editor.current.tpl.tpl,complete:function(transport){var response=transport.responseJSON||{error:true};AmCharts.Editor.current.user.loading=false;AmCharts.Editor.current.tpl.loaded=true;if(!response.error){jQuery('.nav-themes li').each(function(){jQuery(this)[jQuery(this).data('theme')=='default'?'addClass':'removeClass']('active');});AmCharts.Editor.init(response);AmCharts.Editor.modal('hide');}else{jQuery.router.go('/');AmCharts.Editor.log('error','receiving chart: '+ data.chart_id);}}});}else if(AmCharts.Editor.current.tpl.loaded!=true){AmCharts.Editor.log('info','new edit redirect');jQuery.router.go('/new/');}});jQuery.router.add('/:chart_id/edit/','/chart/edit/',function(data){AmCharts.Editor.log('info','route edit chart');if(AmCharts.Editor.current.user.loading){return false;}
AmCharts.Editor.updateSection('editor');if(AmCharts.Editor.current.chart.chart_id){AmCharts.Editor.modal('hide');}else{AmCharts.Editor.current.user.loading=true;AmCharts.Editor.ajax({data:{action:'amcharts_editor_get_chart',chart_id:data.chart_id},complete:function(transport){var response=transport.responseJSON||{error:true};AmCharts.Editor.current.user.loading=false;jQuery.extend(AmCharts.Editor.current.chart,response);if(!response.error){var chartCFG=AmCharts.Editor.parseJSON(response.code);var chartTPL=AmCharts.Editor.parseJSON(response.template);var chartCSS=AmCharts.Editor.parseJSON((response.css||'{}'));jQuery.extend(AmCharts.Editor.current.cfg,chartCFG||{});jQuery.extend(AmCharts.Editor.current.tpl,chartTPL||{});jQuery.extend(AmCharts.Editor.current.css,chartCSS||{});jQuery('.nav-themes li').each(function(){jQuery(this)[jQuery(this).data('theme')==chartCFG.theme?'addClass':'removeClass']('active');});if(!chartCFG.dataProvider){jQuery('.am-tab-data').hide();jQuery('.am-tab-code a').tab('show');}else{jQuery('.am-tab-data').show().find('a').tab('show');}
AmCharts.Editor.init(chartCFG);AmCharts.Editor.modal('hide');if(!AmCharts.Editor.current.chart.owner){AmCharts.Editor.current.stranger=true;AmCharts.Editor.log('info','chart doesnt belong to this user ');jQuery.router.go('/new/edit/');}}else{jQuery.router.go('/');AmCharts.Editor.log('error','receiving chart: '+ data.chart_id);}}});}});jQuery.router.add('/:chart_id/edit/draft/','/chart/edit/draft/',function(data){AmCharts.Editor.log('info','route edit draft');if(AmCharts.Editor.current.user.loading){return false;}
AmCharts.Editor.updateSection('editor');if(AmCharts.Editor.current.chart.chart_id){AmCharts.Editor.modal('hide');}else{AmCharts.Editor.current.user.loading=true;AmCharts.Editor.ajax({data:{action:'amcharts_editor_get_chart',chart_id:data.chart_id,draft:'1'},complete:function(transport){var response=transport.responseJSON||{error:true};AmCharts.Editor.current.user.loading=false;jQuery.extend(AmCharts.Editor.current.chart,response);if(!response.error){var chartCFG=AmCharts.Editor.parseJSON(response.code);var chartTPL=AmCharts.Editor.parseJSON(response.template);var chartCSS=AmCharts.Editor.parseJSON((response.css||'{}'));jQuery.extend(AmCharts.Editor.current.cfg,chartCFG||{});jQuery.extend(AmCharts.Editor.current.tpl,chartTPL||{});jQuery.extend(AmCharts.Editor.current.css,chartCSS||{});jQuery('.nav-themes li').each(function(){jQuery(this)[jQuery(this).data('theme')==chartCFG.theme?'addClass':'removeClass']('active');});AmCharts.Editor.init(chartCFG);AmCharts.Editor.modal('hide');}else{jQuery.router.go('/');AmCharts.Editor.log('error','receiving chart: '+ data.chart_id);}}});}});routeCallback=function(data){AmCharts.Editor.log('info','route share chart');if(AmCharts.Editor.current.user.loading){return false;}
if(AmCharts.Editor.current.chart.chart_id){AmCharts.Editor.updateSection('share');AmCharts.Editor.modal('hide');}else{AmCharts.Editor.log('info','LOAD share chart');AmCharts.Editor.current.user.loading=true;AmCharts.Editor.ajax({data:{action:'amcharts_editor_get_chart',chart_id:data.chart_id},complete:function(transport){var response=transport.responseJSON||{error:true};AmCharts.Editor.current.user.loading=false;jQuery.extend(AmCharts.Editor.current.chart,response);if(!response.error){var chartCFG=AmCharts.Editor.parseJSON(response.code);var chartTPL=AmCharts.Editor.parseJSON(response.template);var chartCSS=AmCharts.Editor.parseJSON((response.css||'{}'));jQuery.extend(AmCharts.Editor.current.cfg,chartCFG||{});jQuery.extend(AmCharts.Editor.current.tpl,chartTPL||{});jQuery.extend(AmCharts.Editor.current.css,chartCSS||{});jQuery('.nav-themes li').each(function(){jQuery(this)[jQuery(this).data('theme')==chartCFG.theme?'addClass':'removeClass']('active');});AmCharts.Editor.dataProvider=chartCFG.dataProvider||[];AmCharts.Editor.updateSection('share');AmCharts.Editor.modal('hide');}else{jQuery.router.go('/');AmCharts.Editor.log('error','receiving chart: '+ data.chart_id);}}});}}
jQuery.router.add('/:chart_id/','/chart/',routeCallback);jQuery.router.add('/:chart_id/share/','/chart/share/',routeCallback);jQuery.router.add('/:chart_id/404/',function(data){AmCharts.Editor.log('info','not found');jQuery.router.go('/');});jQuery.router.add('/:chart_id/:action/','/chart/action/',function(data){AmCharts.Editor.log('info',data);jQuery.router.go('/');});jQuery(document).ready(function(){jQuery.router.go(location.hash.slice(1));AmCharts.Editor.getUser();setTimeout(function(){jQuery('body').removeClass('glamorize');jQuery('.modal-backdrop-init').removeClass('in').one($.support.transition.end,function(){jQuery(this).remove();}).emulateTransitionEnd(300);},1000);});